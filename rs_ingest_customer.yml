version: v1beta1
name: wf-redshift-retail-01
type: workflow
description: To read data from bigquery
tags:
  - redshift
  - retail
workflow:
  dag:
    - name: read-redshift-retail-customer-01
      title: Read Redshift Retail Dataset
      description: Reads the data from amazon redshift
      spec:
        tags:
          - redshift
          - connect
        stack: flare:3.0
        envs:
          HERA_SSL: "false"
          HERA_BASE_URL: "https://flexible-buffalo.dataos.app/hera"
        flare:
          driver:
            coreLimit: 1200m
            cores: 1
            memory: 1000m
          executor:
            coreLimit: 1200m
            cores: 1
            instances: 1
            memory: 1000m
          job:
            inputs:
              - name: customer_input
                dataset: dataos://redshiftstacknexus:public/customer
                format: redshift
                schema: dataos://thirdparty01:schemas/stacknexus/customer.avsc
            logLevel: INFO
            outputs:
              - name: customer_output
                depot: dataos://icebase:sample?acl=rw
            steps:
              - sink:
                  - sequenceName: customer_input
                    datasetName: retail_customer_01
                    outputName: customer_output
                    outputType: Iceberg
                    description: customer data from redshift
                    title: retail customer
                    tags:
                      - redshift
                      - retail
                    outputOptions:
                      saveMode: overwrite
                sequence:
                  - name: changed_datatypes
                    sql: select * from customer_input
                    functions:
                    - name: drop
                      columns:
                        - __metadata_dataos_run_mapper_id
                    - name: set_type
                      columns:
                        birthdate: DATE
                        age: INTEGER
                        number_of_children: INTEGER
                        annual_income: INTEGER
    - name: dataos-tool-from-rs
      spec:
        stack: toolbox
        toolbox:
          dataset: dataos://icebase:sample/retail_customer_01?acl=rw
          action:
            name: set_version
            value: latest
      dependencies:
        - read-redshift-retail-customer-01
